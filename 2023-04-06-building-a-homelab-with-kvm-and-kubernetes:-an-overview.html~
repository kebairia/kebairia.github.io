<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-05-11 Thu 19:02 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Building a Homelab with KVM and Kubernetes</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Zakaria.K" />
<meta name="keywords" content="blog,kvm,linux,kubernetes,haproxy,keepalived,homelab" />
<link rel="stylesheet"href="css/main.css" type="text/css" />
</head>
<body>
<div id="content">
<h1 class="title">Building a Homelab with KVM and Kubernetes
<br />
<span class="subtitle">An overview</span>
</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org96d484b">1. Introduction</a></li>
<li><a href="#org9cc0456">2. Architecture</a></li>
<li><a href="#org8113eaf">3. VM Setup Guides</a></li>
</ul>
</div>
</div>
<div class="date">
<p>
Date: 06 April 2023
</p>

</div>
<div id="outline-container-org96d484b" class="outline-2">
<h2 id="org96d484b"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
I'm planning to build a homelab for the purpose of learning and experimenting. This lab will utilize containers and, if necessary, virtual machines (VMs). It will serve as a personal playground where I can explore and test various technologies.
</p>

<p>
The main reason for building this homelab is to help me test and learn new technologies that I'm interested in, as well as the ones that I need for work. 
</p>

<p>
To achieve this objective, I have identified the following needs:
</p>



<ul class="org-ul">
<li>I need a fast and efficient method for provisioning new virtual machines.
For that, I created a tool called <a href="https://www.github.com/kebairia/kvmcli">kvmcli</a>. I designed this tool to simplify the process of creating and deploying new VMs by utilizing a user-friendly YAML file that describes the entire cluster. With just a few options selected, I can effortlessly generate a complete and robust cluster, ready for experimentation.</li>
<li>To centralize the configuration as much as possible, I will be using Packer to create my VMs and Ansible for configuration management.
The ultimate goal is to create a disposable and replaceable ephemeral sandboxes that allow for seamless experimentation.</li>
<li>Kubernetes will play a prominent role in the homelab, serving as a fundamental component.<br />
A significant portion of the services I require will be based on Kubernetes.</li>
</ul>
</div>
</div>


<div id="outline-container-org9cc0456" class="outline-2">
<h2 id="org9cc0456"><span class="section-number-2">2</span> Architecture</h2>
<div class="outline-text-2" id="text-2">
<p>
For a quick summary of the cluster details, please refer to the table below.
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Hostname</th>
<th scope="col" class="org-right">IP Address</th>
<th scope="col" class="org-right">RAM (MB)</th>
<th scope="col" class="org-right">CPUs</th>
<th scope="col" class="org-left">Software</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">admin1</td>
<td class="org-left">admin1.hl.test</td>
<td class="org-right">10.10.0.2</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">DNS/DHCP/HAProxy/Keepalived</td>
</tr>

<tr>
<td class="org-left">admin2</td>
<td class="org-left">admin2.hl.test</td>
<td class="org-right">10.10.0.3</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">DNS/DHCP/HAProxy/Keepalived</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">storage</td>
<td class="org-left">storage.hl.test</td>
<td class="org-right">10.10.0.10</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">NFS / Log server</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">monitor</td>
<td class="org-left">monitor.hl.test</td>
<td class="org-right">10.10.0.11</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">Prometheus/Grafana</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">master1</td>
<td class="org-left">master1.hl.test</td>
<td class="org-right">10.10.0.21</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">master2</td>
<td class="org-left">master2.hl.test</td>
<td class="org-right">10.10.0.22</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">Kubernetes</td>
</tr>

<tr>
<td class="org-left">master3</td>
<td class="org-left">master3.hl.test</td>
<td class="org-right">10.10.0.23</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">worker1</td>
<td class="org-left">worker1.hl.test</td>
<td class="org-right">10.10.0.31</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">worker2</td>
<td class="org-left">worker2.hl.test</td>
<td class="org-right">10.10.0.32</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">Kubernetes</td>
</tr>

<tr>
<td class="org-left">worker3</td>
<td class="org-left">worker3.hl.test</td>
<td class="org-right">10.10.0.33</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
Here's the homelab diagram for our setup.
</p>

<div class="rightnote">
<p>
These are the <b>admin nodes</b>, one serving as the master node <code>IP: 10.10.0.2</code> and the other as the slave node <code>IP: 10.10.0.3</code>.<br />
Both nodes are equipped with <b>DNS</b>, <b>DHCP</b>, <b>HAProxy</b> and <b>Keepalived</b> services installed and configured, which ensures continuous service availability and failover capabilities.<br />
The nodes are configured with a <code>virtual IP: 10.10.0.20</code>, which provides a single IP address to contact with.<br />
<br />
<br />
My <b>Kubernetes cluster</b> will consist of 6 Nodes in total 3 of these nodes will act as Master nodes <code>10.10.0.21-23</code>.<br />
While the other 3 as worker nodes <code>10.10.0.31-33</code>.
</p>

</div>


<div class="figure">
<p><img src="img/blogs/homelab/overview/arch.png" alt="arch.png" width="630" />
</p>
<p><span class="figure-number">Figure 1: </span>Homelab diagram</p>
</div>

<p>
The workflow will be as following
</p>


<p>
This was an overview of my homelab plan. In the following blog posts I will provide detailed setup and configuration guides for each component of the homelab.
</p>
<div class="leftnote">
<p>
I will be keeping the list of blog posts below up-to-date with each new article related to this homelab that I publish on my blog.
</p>

</div>
</div>
</div>
<div id="outline-container-org8113eaf" class="outline-2">
<h2 id="org8113eaf"><span class="section-number-2">3</span> VM Setup Guides</h2>
<div class="outline-text-2" id="text-3">
<p>
This was an overview of my homelab plan. The links below provide detailed setup and configuration guides for each component of the homelab.
</p>
<ul class="org-ul">
<li>Admins
<ul class="org-ul">
<li><a href="2023-04-11-building-qemu-kvm-images-with-packer-(part-I).html">Building Qemu-Kvm Images With Packer (Part I) &#x2013; RockyLinux9</a></li>
<li><a href="2023-04-14-configure-dns-servers-with-failover-using-bind.html">Configure DNS servers with failover using BIND</a></li>
</ul></li>
<li>Kubernetes</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="postamble"> 

<a href="http://creativecommons.org/licenses/by-sa/4.0/" class="crc">
<img src="img/crc.png" alt="Creative Commons License" title="Creative Commons License" />

<a href="https://www.linkedin.com/in/zakaria-kebairia/" title="LinkedIn account" class="social">
<img src="img/social/linkedin-icon-logo.svg" width="45" alt="LinkedIn Account" />
</a>

<a href="https://twitter.com/z_kebairia" title="Twitter Account" class="social">
<img src="img/social/twitter-logo.svg" width="40" alt="Twitter Account" /> </a>

<a href="https://www.youtube.com/channel/UC7OqXJDFQI8_WFC6WnsWCrg" title="Youtube Account" class="social">
<img src="img/social/youtube-black-logo.svg" width="40" alt="Youtube Account" /> </a>

<a href="https://www.github.com/kebairia" title="GitHub Account" class="social">
<img src="img/social/github.svg" width="43" alt="GitHub Account" /> </a>

<br>

<p class="credit">
Copyright &copy  2023 Zakaria Kebairia
<br>
Content licensed <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a> unless otherwise noted.

</p>
</div>
</body>
</html>
