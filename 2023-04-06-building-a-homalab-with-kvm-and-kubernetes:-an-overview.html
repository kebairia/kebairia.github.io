<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-04-13 Thu 17:17 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Building a Homalab with KVM and Kubernetes: An Overview</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Zakaria.K" />
<meta name="keywords" content="blog,kvm,linux,kubernetes,haproxy,keepalived,homelab" />
<link rel="stylesheet"href="css/main.css" type="text/css" />
<header> <h4> <a href="https://kebairia.github.io" title="Home" class="home">
	          <img src="img/home.svg" width="50" alt="Home" />
	          </a>
	          <a href="files/feed.rss" title="RSS Feed" type="application/rss+xml" class="rss">
	          <img src="img/rss.svg" alt="RSS icon" />
	          </a>
                      <a href="files/cv.pdf" title="My Resume" type="application/pdf" class="resume">
                      <img src="img/cv.svg" width="25"  alt="My CV icon" /> </a>
                      </h4>
	          </header>
</head>
<body>
<div id="content">
<h1 class="title">Building a Homalab with KVM and Kubernetes: An Overview
<br />
<span class="subtitle">--</span>
</h1>
<div class="date">
<p>
06 Apr 2023 Tue
</p>

</div>
<div id="outline-container-org309f435" class="outline-2">
<h2 id="org309f435"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
I'm planning to build a highly available Kubernetes homelab cluster that consists of three control plane nodes and three worker nodes (this can change overtime).
The control plane nodes will be responsible for managing the Kubernetes cluster, while the worker nodes will run the workloads.
</p>

<p>
The main reason for building this homelab is to help me to test and learn new technologies that I'm interested in, as well as the ones that I need for work. In addition, I need it to be fully automated so that I can provision new VMs quickly if necessary.
</p>

<p>
To centralize the configuration as much as possible, I will be using Packer to create my VMs and Ansible for configuration management. The ultimate goal is to create an ephemeral sandboxes that can be easily disposed of and replaced, allowing for experimentation.
</p>
</div>
</div>

<div id="outline-container-org4f9917d" class="outline-2">
<h2 id="org4f9917d"><span class="section-number-2">2</span> Tools and technologies</h2>
<div class="outline-text-2" id="text-2">
<p>
Each node will have SELinux in enforcing mode.
</p>

<p>
Firewalld will also be enabled on all the nodes to provide an additional layer of network security.
</p>

<p>
The two admin nodes will serve as the main DNS and DHCP servers for the entire homelab, and we will use HAProxy and Keepalived to provide high availability for the control plane nodes.
</p>

<p>
To provide storage for the cluster, we will dedicate another node as an NFS server. This node will also be utilized as a log server, helping to centralize all the logs in one location for easier management and troubleshooting.
</p>

<p>
To make the process of provisioning new nodes easier, I will create custom base images for Ubuntu server and RockyLinux using Packer. These images will include essential configurations like (SSH, network settings, users&#x2026;etc) making it easier to provision new nodes in the future.
</p>
</div>
</div>

<div id="outline-container-org51d208b" class="outline-2">
<h2 id="org51d208b"><span class="section-number-2">3</span> Architecture</h2>
<div class="outline-text-2" id="text-3">
<p>
For a quick summary of the cluster details, please refer to the table below.
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-left">Hostname</th>
<th scope="col" class="org-right">IP Address</th>
<th scope="col" class="org-right">RAM (MB)</th>
<th scope="col" class="org-right">CPUs</th>
<th scope="col" class="org-left">Software</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">admin1</td>
<td class="org-left">admin1.hl.test</td>
<td class="org-right">10.10.0.2</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">DNS/DHCP/HAProxy/Keepalived</td>
</tr>

<tr>
<td class="org-left">admin2</td>
<td class="org-left">admin2.hl.test</td>
<td class="org-right">10.10.0.3</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">DNS/DHCP/HAProxy/Keepalived</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">storage</td>
<td class="org-left">storage.hl.test</td>
<td class="org-right">10.10.0.10</td>
<td class="org-right">1024</td>
<td class="org-right">1</td>
<td class="org-left">NFS / Log server</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">master1</td>
<td class="org-left">master1.hl.test</td>
<td class="org-right">10.10.0.21</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">master2</td>
<td class="org-left">master2.hl.test</td>
<td class="org-right">10.10.0.22</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">Kubernetes</td>
</tr>

<tr>
<td class="org-left">master3</td>
<td class="org-left">master3.hl.test</td>
<td class="org-right">10.10.0.23</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">worker1</td>
<td class="org-left">worker1.hl.test</td>
<td class="org-right">10.10.0.31</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">worker2</td>
<td class="org-left">worker2.hl.test</td>
<td class="org-right">10.10.0.32</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">Kubernetes</td>
</tr>

<tr>
<td class="org-left">worker3</td>
<td class="org-left">worker3.hl.test</td>
<td class="org-right">10.10.0.33</td>
<td class="org-right">2048</td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
Here's the homelab diagram for our setup.
</p>

<div class="note">
<p>
These are the <b>admin nodes</b>, one serving as the master node <code>IP: 10.10.0.2</code> and the other as the slave node <code>IP: 10.10.0.3</code>.<br />
Both nodes are equipped with <b>DNS</b>, <b>DHCP</b>, <b>HAProxy</b> and <b>Keepalived</b> services installed and configured, which ensures continuous service availability and failover capabilities.<br />
The nodes are configured with a <code>virtual IP: 10.10.0.20</code>, which provides a single IP address to contact with.<br />
<br />
<br />
My <b>Kubernetes cluster</b> will consist of 6 Nodes in total 3 of these nodes will act as Master nodes <code>10.10.0.21-23</code>.<br />
While the other 3 as worker nodes <code>10.10.0.31-33</code>.
</p>

</div>


<div class="figure">
<p><img src="img/blogs/homelab/arch.png" alt="arch.png" width="630" />
</p>
<p><span class="figure-number">Figure 1: </span>Homelab diagram</p>
</div>
<div class="note">

</div>


<p>
This was an overview of my homelab plan. In the following blog posts I will provide detailed setup and configuration guides for each component of the homelab.
</p>
</div>
</div>
<div id="outline-container-orge59a2de" class="outline-2">
<h2 id="orge59a2de"><span class="section-number-2">4</span> VM Setup Guides</h2>
<div class="outline-text-2" id="text-4">
<p>
This was an overview of my homelab plan. The links below provide detailed setup and configuration guides for each component of the homelab.
</p>
<ul class="org-ul">
<li>Admins
<ul class="org-ul">
<li><a href="2023-04-11-building-qemu-kvm-images-with-packer-(part-I).html">Building Qemu-Kvm Images With Packer (Part I) &#x2013; RockyLinux9</a></li>
</ul></li>
<li>Kubernetes</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">

<p class="postamble"> 

<a href="http://creativecommons.org/licenses/by-sa/4.0/" class="crc">
<img src="img/crc.png" alt="Creative Commons License" title="Creative Commons License" />

<a href="https://www.linkedin.com/in/zakaria-kebairia/" title="LinkedIn account" class="social">
<img src="img/social/linkedin-icon-logo.svg" width="45" alt="LinkedIn Account" />
</a>

<a href="https://twitter.com/z_kebairia" title="Twitter Account" class="social">
<img src="img/social/twitter-logo.svg" width="40" alt="Twitter Account" /> </a>

<a href="https://www.youtube.com/channel/UC7OqXJDFQI8_WFC6WnsWCrg" title="Youtube Account" class="social">
<img src="img/social/youtube-black-logo.svg" width="40" alt="Youtube Account" /> </a>

<a href="https://www.github.com/kebairia" title="GitHub Account" class="social">
<img src="img/social/github.svg" width="43" alt="GitHub Account" /> </a>

<br>

<p class="credit">
Copyright &copy  2021 Zakaria Kebairia
<br>
Content licensed <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a> unless otherwise noted.

</p>
</div>
</body>
</html>
